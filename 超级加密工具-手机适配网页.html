<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å…¨å­—ç¬¦åŠ å¯†ç³»ç»Ÿ + è¶…çº§åŠ å¯†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            padding: 15px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            width: 100%;
            overflow: hidden;
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #4a6ee0 0%, #6a3dba 100%);
            color: white;
            padding: 20px;
            position: relative;
            cursor: pointer;
            user-select: none;
        }
        
        .header h1 {
            font-size: 22px;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .content {
            padding: 20px;
        }
        
        .panel {
            margin-bottom: 20px;
        }
        
        .panel h2 {
            color: #444;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #f0f0f0;
            font-weight: 600;
            display: flex;
            align-items: center;
            font-size: 18px;
        }
        
        .panel h2 .icon {
            margin-right: 8px;
            font-size: 18px;
        }
        
        textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            resize: none;
            transition: all 0.3s;
            line-height: 1.5;
            min-height: 150px;
        }
        
        textarea:focus {
            outline: none;
            border-color: #4a6ee0;
            box-shadow: 0 0 0 2px rgba(74, 110, 224, 0.2);
        }
        
        .output-panel textarea {
            background: #f8f9fa;
        }
        
        .settings {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .setting-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #444;
            font-size: 14px;
            display: flex;
            align-items: center;
        }
        
        label .icon {
            margin-right: 6px;
            font-size: 16px;
        }
        
        select, input {
            padding: 14px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            width: 100%;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: #4a6ee0;
            box-shadow: 0 0 0 2px rgba(74, 110, 224, 0.2);
        }
        
        .super-encryption {
            background: linear-gradient(135deg, #8e2de2, #4a00e0);
            color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .super-encryption h3 {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            font-size: 18px;
        }
        
        .super-encryption h3 .icon {
            margin-right: 8px;
        }
        
        .super-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .super-controls button {
            width: 100%;
        }
        
        .index-code {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .index-code h3 {
            color: #444;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            font-size: 18px;
        }
        
        .index-code h3 .icon {
            margin-right: 8px;
        }
        
        .index-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }
        
        .index-controls button {
            width: 100%;
        }
        
        .charset-editor {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }
        
        .charset-editor h3 {
            color: #444;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            font-size: 18px;
        }
        
        .charset-editor h3 .icon {
            margin-right: 8px;
        }
        
        .charset-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }
        
        .charset-controls button {
            width: 100%;
        }
        
        .hidden-dev-panel {
            display: none;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        button {
            padding: 16px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }
        
        .primary-btn {
            background: linear-gradient(135deg, #4a6ee0 0%, #6a3dba 100%);
            color: white;
        }
        
        .primary-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 6px rgba(74, 110, 224, 0.4);
        }
        
        .secondary-btn {
            background: #f0f2f5;
            color: #444;
        }
        
        .secondary-btn:active {
            background: #e4e6e9;
        }
        
        .super-btn {
            background: linear-gradient(135deg, #8e2de2, #4a00e0);
            color: white;
        }
        
        .super-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 6px rgba(142, 45, 226, 0.4);
        }
        
        .dev-btn {
            background: linear-gradient(135deg, #ff4757 0%, #ff3742 100%);
            color: white;
        }
        
        .dev-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 6px rgba(255, 71, 87, 0.4);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .stat {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 22px;
            font-weight: 700;
            color: #4a6ee0;
        }
        
        .stat-label {
            font-size: 13px;
            color: #666;
            margin-top: 4px;
        }
        
        .info-panel {
            background: #e8f4fd;
            border-left: 4px solid #4a6ee0;
            padding: 16px;
            border-radius: 0 8px 8px 0;
            margin-bottom: 20px;
        }
        
        .info-panel h3 {
            color: #4a6ee0;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            font-size: 18px;
        }
        
        .info-panel h3 .icon {
            margin-right: 8px;
        }
        
        .info-panel ul {
            padding-left: 20px;
            color: #555;
        }
        
        .info-panel li {
            margin-bottom: 6px;
            font-size: 14px;
        }
        
        .character-types {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }
        
        .char-type {
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
        }
        
        .char-type.active {
            background: #4a6ee0;
            color: white;
        }
        
        .copy-input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .copy-input-group input {
            margin-bottom: 0;
        }
        
        .copy-buttons {
            display: flex;
            gap: 10px;
        }
        
        .copy-buttons button {
            flex: 1;
        }
        
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.3s;
        }
        
        .message.success {
            background: #4CAF50;
        }
        
        .message.error {
            background: #f44336;
        }
        
        .message.warning {
            background: #ff9800;
        }
        
        .message.info {
            background: #2196F3;
        }
        
        /* é’ˆå¯¹å°å±å¹•çš„é¢å¤–ä¼˜åŒ– */
        @media (max-width: 360px) {
            .header h1 {
                font-size: 20px;
            }
            
            .header p {
                font-size: 13px;
            }
            
            .content {
                padding: 15px;
            }
            
            textarea {
                min-height: 120px;
                font-size: 15px;
            }
            
            button {
                padding: 14px 16px;
                font-size: 15px;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header" id="header">
            <h1>å…¨å­—ç¬¦åŠ å¯†ç³»ç»Ÿ + è¶…çº§åŠ å¯†</h1>
            <p>æ”¯æŒæ™®é€šåŠ å¯†å’Œè¶…çº§åŠ å¯†æ¨¡å¼ï¼Œç”Ÿæˆå¤–æ˜Ÿæ–‡èˆ¬çš„åŠ å¯†ç»“æœ</p>
        </div>
        
        <div class="content">
            <div class="panel input-panel">
                <h2><span class="icon">ğŸ“¥</span>è¾“å…¥æ–‡æœ¬</h2>
                <textarea id="inputText" placeholder="è¯·è¾“å…¥è¦åŠ å¯†çš„æ–‡æœ¬ï¼Œæ”¯æŒæ‰€æœ‰å­—ç¬¦ç±»å‹...">Hello ä¸–ç•Œï¼123 ğŸŒŸ è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡æœ¬ï¼ŒåŒ…å«å„ç§å­—ç¬¦ï¼šABCabcã€æ ‡ç‚¹ç¬¦å·ï¼ï¼Ÿå’Œè¡¨æƒ…ğŸ˜ŠğŸ‰</textarea>
            </div>
            
            <div class="panel output-panel">
                <h2><span class="icon">ğŸ“¤</span>è¾“å‡ºç»“æœ</h2>
                <textarea id="outputText" readonly placeholder="åŠ å¯†æˆ–è§£å¯†ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
            </div>
            
            <div class="settings">
                <div class="setting-group">
                    <label><span class="icon">ğŸ”„</span>å¾ªç¯åŠ å¯†æ¬¡æ•°</label>
                    <select id="rounds">
                        <option value="1">1æ¬¡</option>
                        <option value="3">3æ¬¡</option>
                        <option value="5" selected>5æ¬¡</option>
                        <option value="7">7æ¬¡</option>
                        <option value="10">10æ¬¡</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label><span class="icon">ğŸ”‘</span>åŠ å¯†å¯†é’¥</label>
                    <input type="text" id="key" placeholder="è¯·è¾“å…¥åŠ å¯†å¯†é’¥..." value="mySecretKey">
                </div>
            </div>
            
            <div class="super-encryption">
                <h3><span class="icon">ğŸ‘½</span>è¶…çº§åŠ å¯†æ¨¡å¼</h3>
                <p style="margin-bottom: 15px; opacity: 0.9;">å¯ç”¨è¶…çº§åŠ å¯†å°†ç”Ÿæˆå¤–æ˜Ÿæ–‡èˆ¬çš„åŠ å¯†ç»“æœï¼Œçœ‹èµ·æ¥åƒä¹±ç ä½†å¯æ­£å¸¸è§£å¯†ã€‚</p>
                
                <div class="super-controls">
                    <button class="super-btn" onclick="superEncrypt()">
                        <span class="icon">ğŸ‘¾</span> è¶…çº§åŠ å¯†
                    </button>
                    <button class="super-btn" onclick="superDecrypt()">
                        <span class="icon">ğŸ›¸</span> è¶…çº§è§£å¯†
                    </button>
                    <button class="secondary-btn" onclick="generateSuperCharset()">
                        <span class="icon">ğŸ²</span> ç”Ÿæˆå¤–æ˜Ÿæ–‡å­—ç¬¦é›†
                    </button>
                </div>
            </div>
            
            <div class="index-code">
                <h3><span class="icon">ğŸ”¢</span>å­—ç¬¦é›†ç´¢å¼•ç </h3>
                <p style="margin-bottom: 10px; color: #666;">ç´¢å¼•ç ç”¨äºä¿å­˜å½“å‰å­—ç¬¦é›†ï¼Œç¡®ä¿é‡å¼€é¡µé¢åä»èƒ½æ­£ç¡®è§£å¯†ã€‚</p>
                
                <div class="copy-input-group">
                    <input type="text" id="indexCode" placeholder="å­—ç¬¦é›†ç´¢å¼•ç å°†åœ¨è¿™é‡Œæ˜¾ç¤º...">
                    <div class="copy-buttons">
                        <button class="secondary-btn" onclick="copyIndexCode()">
                            <span class="icon">ğŸ“‹</span> å¤åˆ¶
                        </button>
                        <button class="secondary-btn" onclick="applyIndexCode()">
                            <span class="icon">ğŸ”„</span> åº”ç”¨
                        </button>
                    </div>
                </div>
                
                <div class="index-controls">
                    <button class="secondary-btn" onclick="generateIndexCode()">
                        <span class="icon">ğŸ”‘</span> ç”Ÿæˆç´¢å¼•ç 
                    </button>
                    <button class="secondary-btn" onclick="saveIndexCodeToStorage()">
                        <span class="icon">ğŸ’¾</span> ä¿å­˜åˆ°æœ¬åœ°
                    </button>
                    <button class="secondary-btn" onclick="loadIndexCodeFromStorage()">
                        <span class="icon">ğŸ“‚</span> ä»æœ¬åœ°åŠ è½½
                    </button>
                </div>
            </div>
            
            <div class="charset-editor">
                <h3><span class="icon">ğŸ” </span>å­—ç¬¦æ˜ å°„è¡¨ (256ä¸ªå­—ç¬¦)</h3>
                <textarea id="charset" style="min-height: 80px; font-size: 14px;"></textarea>
                
                <div class="charset-controls">
                    <button class="secondary-btn" onclick="generateRandomCharset()">
                        <span class="icon">ğŸ²</span> éšæœºç”Ÿæˆ
                    </button>
                    <button class="secondary-btn" onclick="validateCharset()">
                        <span class="icon">âœ…</span> éªŒè¯å­—ç¬¦é›†
                    </button>
                    <button class="secondary-btn" onclick="resetDefaultCharset()">
                        <span class="icon">ğŸ”„</span> æ¢å¤é»˜è®¤
                    </button>
                </div>
            </div>
            
            <div class="hidden-dev-panel" id="devPanel">
                <h3><span class="icon">âš™ï¸</span>å¼€å‘è€…è®¾ç½®</h3>
                <p style="margin-bottom: 15px; color: #856404;">å¼€å‘è€…æ¨¡å¼å…è®¸åœ¨æ²¡æœ‰å¯†é’¥çš„æƒ…å†µä¸‹è§£å¯†ï¼Œä»…é™å†…éƒ¨ä½¿ç”¨ã€‚</p>
                
                <div class="controls">
                    <button class="dev-btn" onclick="decryptWithoutKey()">
                        <span class="icon">ğŸ› ï¸</span> æ— å¯†é’¥è§£å¯†
                    </button>
                    <button class="dev-btn" onclick="enableBackdoor()">
                        <span class="icon">ğŸšª</span> å¯ç”¨åé—¨
                    </button>
                    <button class="secondary-btn" onclick="showDevInfo()">
                        <span class="icon">â„¹ï¸</span> å¼€å‘è€…ä¿¡æ¯
                    </button>
                </div>
            </div>
            
            <div class="controls">
                <button class="primary-btn" onclick="encrypt()">
                    <span class="icon">ğŸ”’</span> æ™®é€šåŠ å¯†
                </button>
                <button class="primary-btn" onclick="decrypt()">
                    <span class="icon">ğŸ”“</span> æ™®é€šè§£å¯†
                </button>
                <button class="secondary-btn" onclick="copyToClipboard()">
                    <span class="icon">ğŸ“‹</span> å¤åˆ¶ç»“æœ
                </button>
                <button class="secondary-btn" onclick="clearAll()">
                    <span class="icon">ğŸ—‘ï¸</span> æ¸…ç©º
                </button>
            </div>
            
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="inputLength">0</div>
                    <div class="stat-label">è¾“å…¥å­—ç¬¦</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="outputLength">0</div>
                    <div class="stat-label">è¾“å‡ºå­—ç¬¦</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="charTypes">0</div>
                    <div class="stat-label">å­—ç¬¦ç±»å‹</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="encryptionRounds">5</div>
                    <div class="stat-label">åŠ å¯†è½®æ¬¡</div>
                </div>
            </div>
            
            <div class="info-panel">
                <h3><span class="icon">ğŸ’¡</span>ç³»ç»Ÿç‰¹ç‚¹</h3>
                <ul>
                    <li>æ”¯æŒæ™®é€šåŠ å¯†å’Œè¶…çº§åŠ å¯†ä¸¤ç§æ¨¡å¼</li>
                    <li>è¶…çº§åŠ å¯†ç”Ÿæˆå¤–æ˜Ÿæ–‡èˆ¬çš„åŠ å¯†ç»“æœï¼Œå¢å¼ºéšè”½æ€§</li>
                    <li>å¯è‡ªå®šä¹‰256å­—ç¬¦æ˜ å°„è¡¨ï¼Œæ”¯æŒæ··åˆå­—ç¬¦ç±»å‹</li>
                    <li>ä½¿ç”¨å¢å¼ºçš„Unicodeç¼–ç ï¼Œç¡®ä¿æ‰€æœ‰å­—ç¬¦æ­£ç¡®åŠ å¯†</li>
                    <li>å¯é…ç½®çš„åŠ å¯†è½®æ¬¡ï¼Œæé«˜å®‰å…¨æ€§</li>
                    <li>æ–°å¢ç´¢å¼•ç åŠŸèƒ½ï¼Œç¡®ä¿é‡å¼€é¡µé¢åä»èƒ½æ­£ç¡®è§£å¯†</li>
                    <li>å®æ—¶å­—ç¬¦ç»Ÿè®¡å’Œç±»å‹åˆ†æ</li>
                </ul>
                
                <div class="character-types" id="charTypesList">
                    <div class="char-type active">æ±‰å­—</div>
                    <div class="char-type active">è‹±æ–‡</div>
                    <div class="char-type active">æ•°å­—</div>
                    <div class="char-type active">æ ‡ç‚¹</div>
                    <div class="char-type active">Emoji</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            
            // æ·»åŠ è¾“å…¥ç›‘å¬
            document.getElementById('inputText').addEventListener('input', updateStats);
            document.getElementById('rounds').addEventListener('change', updateStats);
            document.getElementById('charset').addEventListener('input', validateCharset);
            
            // ç¡®ä¿å­—ç¬¦é›†æœ‰æ•ˆ
            if (!validateCharset()) {
                resetDefaultCharset();
            }
            
            // éšè—å¼€å‘è€…æ¨¡å¼æ¿€æ´»
            let clickCount = 0;
            let lastClickTime = 0;
            document.getElementById('header').addEventListener('click', function() {
                const now = Date.now();
                if (now - lastClickTime > 1000) {
                    clickCount = 0;
                }
                
                clickCount++;
                lastClickTime = now;
                
                if (clickCount >= 5) {
                    toggleDevPanel();
                    clickCount = 0;
                }
            });
            
            // å°è¯•ä»æœ¬åœ°å­˜å‚¨åŠ è½½å­—ç¬¦é›†
            loadCharsetFromStorage();
        });
        
        // åˆ‡æ¢å¼€å‘è€…é¢æ¿
        function toggleDevPanel() {
            const devPanel = document.getElementById('devPanel');
            if (devPanel.style.display === 'block') {
                devPanel.style.display = 'none';
                showMessage('å¼€å‘è€…é¢æ¿å·²éšè—', 'info');
            } else {
                devPanel.style.display = 'block';
                showMessage('å¼€å‘è€…é¢æ¿å·²æ¿€æ´»ï¼', 'success');
            }
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const inputText = document.getElementById('inputText').value;
            const outputText = document.getElementById('outputText').value;
            const rounds = document.getElementById('rounds').value;
            
            document.getElementById('inputLength').textContent = inputText.length;
            document.getElementById('outputLength').textContent = outputText.length;
            document.getElementById('encryptionRounds').textContent = rounds;
            
            // åˆ†æå­—ç¬¦ç±»å‹
            const charTypes = analyzeCharacterTypes(inputText);
            document.getElementById('charTypes').textContent = charTypes.count;
            
            // æ›´æ–°å­—ç¬¦ç±»å‹æ˜¾ç¤º
            updateCharTypesDisplay(charTypes);
        }
        
        // åˆ†æå­—ç¬¦ç±»å‹
        function analyzeCharacterTypes(text) {
            const types = {
                chinese: 0,
                english: 0,
                number: 0,
                punctuation: 0,
                emoji: 0,
                other: 0
            };
            
            for (let char of text) {
                const code = char.charCodeAt(0);
                
                // æ±‰å­—
                if (code >= 0x4E00 && code <= 0x9FFF) {
                    types.chinese++;
                }
                // è‹±æ–‡
                else if ((code >= 0x0041 && code <= 0x005A) || (code >= 0x0061 && code <= 0x007A)) {
                    types.english++;
                }
                // æ•°å­—
                else if (code >= 0x0030 && code <= 0x0039) {
                    types.number++;
                }
                // æ ‡ç‚¹ç¬¦å·ï¼ˆç®€å•åˆ¤æ–­ï¼‰
                else if ((code >= 0x2000 && code <= 0x206F) || 
                         (code >= 0x3000 && code <= 0x303F) ||
                         [0x0021, 0x0022, 0x0027, 0x0028, 0x0029, 0x002C, 0x002D, 0x002E, 0x002F, 
                          0x003A, 0x003B, 0x003F, 0x0040, 0x005B, 0x005C, 0x005D, 0x005F, 0x0060, 
                          0x007B, 0x007C, 0x007D, 0x007E].includes(code)) {
                    types.punctuation++;
                }
                // Emoji
                else if ((code >= 0x1F600 && code <= 0x1F64F) || 
                         (code >= 0x1F300 && code <= 0x1F5FF) ||
                         (code >= 0x1F680 && code <= 0x1F6FF) ||
                         (code >= 0x2600 && code <= 0x26FF) ||
                         (code >= 0x2700 && code <= 0x27BF)) {
                    types.emoji++;
                }
                // å…¶ä»–
                else {
                    types.other++;
                }
            }
            
            // è®¡ç®—ç±»å‹æ•°é‡ï¼ˆæœ‰å‡ºç°çš„ç±»å‹ï¼‰
            let typeCount = 0;
            for (let type in types) {
                if (types[type] > 0) typeCount++;
            }
            
            return {
                types: types,
                count: typeCount
            };
        }
        
        // æ›´æ–°å­—ç¬¦ç±»å‹æ˜¾ç¤º
        function updateCharTypesDisplay(charTypes) {
            const typeElements = document.querySelectorAll('.char-type');
            const typeMap = {
                'æ±‰å­—': 'chinese',
                'è‹±æ–‡': 'english',
                'æ•°å­—': 'number',
                'æ ‡ç‚¹': 'punctuation',
                'Emoji': 'emoji'
            };
            
            typeElements.forEach(element => {
                const type = typeMap[element.textContent];
                if (charTypes.types[type] > 0) {
                    element.classList.add('active');
                } else {
                    element.classList.remove('active');
                }
            });
        }
        
        // éªŒè¯å­—ç¬¦é›†
        function validateCharset() {
            const charset = document.getElementById('charset').value;
            const uniqueChars = new Set(charset);
            
            if (charset.length !== 256) {
                showMessage(`å­—ç¬¦é›†é•¿åº¦åº”ä¸º256ï¼Œå½“å‰ä¸º${charset.length}`, 'warning');
                return false;
            }
            
            if (uniqueChars.size !== 256) {
                showMessage(`å­—ç¬¦é›†åŒ…å«${256 - uniqueChars.size}ä¸ªé‡å¤å­—ç¬¦`, 'error');
                return false;
            }
            
            return true;
        }
        
        // ç”Ÿæˆéšæœºå­—ç¬¦é›†
        function generateRandomCharset() {
            let charset = '';
            const used = new Set();
            
            // æ·»åŠ æ•°å­—
            for (let i = 0; i < 10; i++) {
                charset += i;
                used.add(i);
            }
            
            // æ·»åŠ å¤§å†™å­—æ¯
            for (let i = 65; i <= 90; i++) {
                const char = String.fromCharCode(i);
                charset += char;
                used.add(char);
            }
            
            // æ·»åŠ å°å†™å­—æ¯
            for (let i = 97; i <= 122; i++) {
                const char = String.fromCharCode(i);
                charset += char;
                used.add(char);
            }
            
            // æ·»åŠ æ±‰å­—
            const start = 0x4E00;
            const end = 0x9FFF;
            while (charset.length < 200) {
                const codePoint = Math.floor(Math.random() * (end - start + 1)) + start;
                const char = String.fromCodePoint(codePoint);
                
                if (!used.has(char)) {
                    charset += char;
                    used.add(char);
                }
            }
            
            // æ·»åŠ emoji
            const emojiRanges = [
                [0x1F600, 0x1F64F], // è¡¨æƒ…ç¬¦å·
                [0x1F300, 0x1F5FF], // æ‚é¡¹ç¬¦å·å’Œè±¡å½¢æ–‡å­—
                [0x1F680, 0x1F6FF], // äº¤é€šå’Œåœ°å›¾ç¬¦å·
                [0x2600, 0x26FF],   // æ‚é¡¹ç¬¦å·
                [0x2700, 0x27BF]    // è£…é¥°ç¬¦å·
            ];
            
            while (charset.length < 256) {
                const range = emojiRanges[Math.floor(Math.random() * emojiRanges.length)];
                const codePoint = Math.floor(Math.random() * (range[1] - range[0] + 1)) + range[0];
                const char = String.fromCodePoint(codePoint);
                
                if (!used.has(char)) {
                    charset += char;
                    used.add(char);
                }
            }
            
            document.getElementById('charset').value = charset;
            validateCharset();
            generateIndexCode();
        }
        
        // ç”Ÿæˆå¤–æ˜Ÿæ–‡å­—ç¬¦é›†
        function generateSuperCharset() {
            let charset = '';
            const used = new Set();
            
            // ä½¿ç”¨å„ç§ä¸å¸¸è§çš„Unicodeå­—ç¬¦å—
            const ranges = [
                [0x0A00, 0x0A7F], // å¤æœ¨åŸºæ–‡
                [0x0B00, 0x0B7F], // å¥¥é‡Œäºšæ–‡
                [0x0C00, 0x0C7F], // å¡çº³è¾¾æ–‡
                [0x0D00, 0x0D7F], // é©¬æ‹‰é›…æ‹‰å§†æ–‡
                [0x0E00, 0x0E7F], // æ³°æ–‡
                [0x0F00, 0x0FFF], // è—æ–‡
                [0x1000, 0x109F], // ç¼…ç”¸æ–‡
                [0x10A0, 0x10FF], // æ ¼é²å‰äºšæ–‡
                [0x1200, 0x137F], // åŸƒå¡ä¿„æ¯”äºšæ–‡
                [0x13A0, 0x13FF], // åˆ‡ç½—åŸºæ–‡
                [0x1400, 0x167F], // ç»Ÿä¸€åŠ æ‹¿å¤§åŸä½æ°‘éŸ³èŠ‚æ–‡å­—
                [0x1680, 0x169F], // æ¬§ç”˜æ–‡
                [0x16A0, 0x16FF], // å¦‚å°¼æ–‡
                [0x1700, 0x171F], // ä»–åŠ ç¦„æ–‡
                [0x1720, 0x173F], // å“ˆåŠªè¯ºæ–‡
                [0x1740, 0x175F], // å¸ƒå¸Œå¾·æ–‡
                [0x1760, 0x177F], // å¡”æ ¼ç­ç“¦æ–‡
                [0x1780, 0x17FF], // é«˜æ£‰æ–‡
                [0x1800, 0x18AF], // è’™å¤æ–‡
                [0x1900, 0x194F], // æ—å¸ƒæ–‡
                [0x1950, 0x197F], // å¾·å®å‚£æ–‡
                [0x19E0, 0x19FF], // é«˜æ£‰ç¬¦å·
                [0x1A00, 0x1A1F], // å¸ƒå‰æ–‡
                [0x1B00, 0x1B7F], // å·´å˜æ–‡
                [0x1B80, 0x1BBF], // å·½ä»–æ–‡
                [0x1C00, 0x1C4F], // é›·å¸ƒæŸ¥æ–‡
                [0x1C50, 0x1C7F], // å¥¥å°”æ°åŸºæ–‡
                [0x1CC0, 0x1CCF], // å·½ä»–è¡¥å……
                [0x1CD0, 0x1CFF], // å é™€æ‰©å±•
                [0x1D00, 0x1D7F], // è¯­éŸ³å­¦æ‰©å±•
                [0x1D80, 0x1DBF], // è¯­éŸ³å­¦æ‰©å±•è¡¥å……
                [0x1DC0, 0x1DFF], // ç»“åˆç”¨è¯»éŸ³ç¬¦å·è¡¥å……
                [0x1E00, 0x1EFF], // æ‹‰ä¸æ–‡æ‰©å±•é™„åŠ 
                [0x1F00, 0x1FFF], // å¸Œè…Šæ–‡æ‰©å±•
                [0x2000, 0x206F], // å¸¸ç”¨æ ‡ç‚¹
                [0x2070, 0x209F], // ä¸Šæ ‡å’Œä¸‹æ ‡
                [0x20A0, 0x20CF], // è´§å¸ç¬¦å·
                [0x20D0, 0x20FF], // ç»„åˆç”¨è®°å·
                [0x2100, 0x214F], // å­—æ¯å¼ç¬¦å·
                [0x2150, 0x218F], // æ•°å­—å½¢å¼
                [0x2190, 0x21FF], // ç®­å¤´
                [0x2200, 0x22FF], // æ•°å­¦è¿ç®—ç¬¦
                [0x2300, 0x23FF], // æ‚é¡¹æŠ€æœ¯ç¬¦å·
                [0x2400, 0x243F], // æ§åˆ¶å›¾ç‰‡
                [0x2440, 0x245F], // å…‰å­¦è¯†åˆ«ç¬¦
                [0x2460, 0x24FF], // å°é—­å¼å­—æ¯æ•°å­—
                [0x2500, 0x257F], // åˆ¶è¡¨ç¬¦
                [0x2580, 0x259F], // æ–¹å—å…ƒç´ 
                [0x25A0, 0x25FF], // å‡ ä½•å›¾å½¢
                [0x2600, 0x26FF], // æ‚é¡¹ç¬¦å·
                [0x2700, 0x27BF], // è£…é¥°ç¬¦å·
                [0x27C0, 0x27EF], // æ‚é¡¹æ•°å­¦ç¬¦å·-A
                [0x27F0, 0x27FF], // è¡¥å……ç®­å¤´-A
                [0x2800, 0x28FF], // ç›²æ–‡ç‚¹å­—æ¨¡å‹
                [0x2900, 0x297F], // è¡¥å……ç®­å¤´-B
                [0x2980, 0x29FF], // æ‚é¡¹æ•°å­¦ç¬¦å·-B
                [0x2A00, 0x2AFF], // è¡¥å……æ•°å­¦è¿ç®—ç¬¦
                [0x2B00, 0x2BFF], // æ‚é¡¹ç¬¦å·å’Œç®­å¤´
                [0x2C00, 0x2C5F], // æ ¼æ‹‰å“¥é‡Œå­—æ¯
                [0x2C60, 0x2C7F], // æ‹‰ä¸æ‰©å±•-C
                [0x2C80, 0x2CFF], // ç§‘æ™®ç‰¹æ–‡
                [0x2D00, 0x2D2F], // æ ¼é²å‰äºšè¡¥å……
                [0x2D30, 0x2D7F], // æéçº³æ–‡
                [0x2D80, 0x2DDF], // åŸƒå¡ä¿„æ¯”äºšæ–‡æ‰©å±•
                [0x2DE0, 0x2DFF], // è¥¿é‡Œå°”æ–‡æ‰©å±•-A
                [0x2E00, 0x2E7F], // è¡¥å……æ ‡ç‚¹
                [0x2E80, 0x2EFF], // CJKéƒ¨é¦–è¡¥å……
                [0x2F00, 0x2FDF], // åº·ç†™éƒ¨é¦–
                [0x2FF0, 0x2FFF], // è¡¨æ„æ–‡å­—æè¿°ç¬¦
                [0x3000, 0x303F], // CJKç¬¦å·å’Œæ ‡ç‚¹
                [0x3040, 0x309F], // æ—¥æ–‡å¹³å‡å
                [0x30A0, 0x30FF], // æ—¥æ–‡ç‰‡å‡å
                [0x3100, 0x312F], // æ³¨éŸ³å­—æ¯
                [0x3130, 0x318F], // éŸ©æ–‡å…¼å®¹å­—æ¯
                [0x3190, 0x319F], // è±¡å½¢å­—æ³¨é‡Šæ ‡å¿—
                [0x31A0, 0x31BF], // æ³¨éŸ³å­—æ¯æ‰©å±•
                [0x31C0, 0x31EF], // CJKç¬”ç”»
                [0x31F0, 0x31FF], // æ—¥æ–‡ç‰‡å‡åè¯­éŸ³æ‰©å±•
                [0x3200, 0x32FF], // å°é—­å¼CJKå­—æ¯å’Œæœˆä»½
                [0x3300, 0x33FF], // CJKå…¼å®¹
                [0x3400, 0x4DBF], // CJKç»Ÿä¸€è¡¨æ„æ–‡å­—æ‰©å±•A
                [0x4DC0, 0x4DFF], // æ˜“ç»å…­åå››å¦ç¬¦å·
                [0x4E00, 0x9FFF], // CJKç»Ÿä¸€è¡¨æ„æ–‡å­—
                [0xA000, 0xA48F], // å½æ–‡éŸ³èŠ‚
                [0xA490, 0xA4CF], // å½æ–‡å­—æ ¹
                [0xA500, 0xA63F], // ç“¦ä¼Šæ–‡
                [0xA640, 0xA69F], // è¥¿é‡Œå°”æ–‡æ‰©å±•-B
                [0xA6A0, 0xA6FF], // å·´å§†ç©†æ–‡
                [0xA700, 0xA71F], // å£°è°ƒä¿®é¥°å­—æ¯
                [0xA720, 0xA7FF], // æ‹‰ä¸æ–‡æ‰©å±•-D
                [0xA800, 0xA82F], // é”¡å°”èµ«ç‰¹æ–‡
                [0xA840, 0xA87F], // å…«æ€å·´æ–‡
                [0xA880, 0xA8DF], // ç´¢æ‹‰ä»€ç‰¹æ‹‰æ–‡
                [0xA8E0, 0xA8FF], // å¤©åŸæ–‡æ‰©å±•
                [0xA900, 0xA92F], // å…‹è€¶æ–‡
                [0xA930, 0xA95F], // å‹’å§œæ–‡
                [0xA960, 0xA97F], // éŸ©æ–‡æ‰©å±•-A
                [0xA980, 0xA9DF], // çˆªå“‡æ–‡
                [0xAA00, 0xAA5F], // å æ–‡
                [0xAA60, 0xAA7F], // ç¼…ç”¸æ–‡æ‰©å±•
                [0xAA80, 0xAADF], // æ³°è¶Šå—æ–‡
                [0xAB00, 0xAB2F], // åŸƒå¡ä¿„æ¯”äºšæ–‡æ‰©å±•-A
                [0xABC0, 0xABFF], // æ¢…æ³°æ–‡ï¼ˆæ›¼å°¼æ™®å°”æ–‡ï¼‰
                [0xAC00, 0xD7AF], // éŸ©æ–‡éŸ³èŠ‚
                [0xD7B0, 0xD7FF], // éŸ©æ–‡æ‰©å±•-B
                [0xF900, 0xFAFF], // CJKå…¼å®¹è±¡å½¢æ–‡å­—
                [0xFB00, 0xFB4F], // å­—æ¯è¡¨è¾¾å½¢å¼
                [0xFB50, 0xFDFF], // é˜¿æ‹‰ä¼¯è¡¨è¾¾å½¢å¼-A
                [0xFE00, 0xFE0F], // å¼‚ä½“å­—é€‰æ‹©å™¨
                [0xFE10, 0xFE1F], // ç«–æ’å½¢å¼
                [0xFE20, 0xFE2F], // ç»„åˆç”¨åŠè®°å·
                [0xFE30, 0xFE4F], // CJKå…¼å®¹å½¢å¼
                [0xFE50, 0xFE6F], // å°å‹å˜ä½“å½¢å¼
                [0xFE70, 0xFEFF], // é˜¿æ‹‰ä¼¯è¡¨è¾¾å½¢å¼-B
                [0xFF00, 0xFFEF], // åŠå‹åŠå…¨å‹å½¢å¼
                [0xFFF0, 0xFFFF], // ç‰¹æ®Š
            ];
            
            // ä»å„ç§èŒƒå›´ä¸­éšæœºé€‰æ‹©å­—ç¬¦
            while (charset.length < 256) {
                const range = ranges[Math.floor(Math.random() * ranges.length)];
                const codePoint = Math.floor(Math.random() * (range[1] - range[0] + 1)) + range[0];
                const char = String.fromCodePoint(codePoint);
                
                // è·³è¿‡æ§åˆ¶å­—ç¬¦å’Œå¸¸è§å­—ç¬¦
                if (!used.has(char) && 
                    codePoint > 0x0020 && // è·³è¿‡æ§åˆ¶å­—ç¬¦
                    !(codePoint >= 0x0030 && codePoint <= 0x0039) && // è·³è¿‡æ•°å­—
                    !(codePoint >= 0x0041 && codePoint <= 0x005A) && // è·³è¿‡å¤§å†™å­—æ¯
                    !(codePoint >= 0x0061 && codePoint <= 0x007A) && // è·³è¿‡å°å†™å­—æ¯
                    !(codePoint >= 0x4E00 && codePoint <= 0x9FFF) // è·³è¿‡å¸¸ç”¨æ±‰å­—
                ) {
                    charset += char;
                    used.add(char);
                }
            }
            
            document.getElementById('charset').value = charset;
            validateCharset();
            generateIndexCode();
            showMessage('å·²ç”Ÿæˆå¤–æ˜Ÿæ–‡å­—ç¬¦é›†ï¼', 'success');
        }
        
        // æ¢å¤é»˜è®¤å­—ç¬¦é›†
        function resetDefaultCharset() {
            const defaultCharset = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyzçš„ä¸€æ˜¯åœ¨ä¸äº†æœ‰å’Œäººè¿™ä¸­å¤§ä¸ºä¸Šä¸ªå›½æˆ‘ä»¥è¦ä»–æ—¶æ¥ç”¨ä»¬ç”Ÿåˆ°ä½œåœ°äºå‡ºå°±åˆ†å¯¹æˆä¼šå¯ä¸»å‘å¹´åŠ¨åŒå·¥ä¹Ÿèƒ½ä¸‹è¿‡å­è¯´äº§ç§é¢è€Œæ–¹åå¤šå®šè¡Œå­¦æ³•æ‰€æ°‘å¾—ç»åä¸‰ä¹‹è¿›ç€ç­‰éƒ¨åº¦å®¶ç”µåŠ›é‡Œå¦‚æ°´åŒ–é«˜è‡ªäºŒç†èµ·å°ç‰©ç°å®åŠ é‡éƒ½ä¸¤ä½“åˆ¶æœºå½“ä½¿ç‚¹ä»ä¸šæœ¬å»æŠŠæ€§å¥½åº”å¼€å®ƒåˆè¿˜å› ç”±å…¶äº›ç„¶å‰å¤–å¤©æ”¿å››æ—¥é‚£ç¤¾ä¹‰äº‹å¹³å½¢ç›¸å…¨è¡¨é—´æ ·ä¸å…³å„é‡æ–°çº¿å†…æ•°æ­£å¿ƒåä½ æ˜çœ‹åŸåˆä¹ˆåˆ©æ¯”æˆ–ä½†è´¨æ°”ç¬¬å‘é“å‘½æ­¤å˜æ¡åªæ²¡ç»“è§£é—®æ„å»ºæœˆå…¬æ— ç³»å†›å¾ˆæƒ…è€…æœ€ç«‹ä»£æƒ³å·²é€šå¹¶æç›´é¢˜å…šç¨‹å±•äº”æœæ–™è±¡å‘˜é©ä½å…¥å¸¸æ–‡æ€»æ¬¡å“å¼æ´»è®¾åŠç®¡ç‰¹ä»¶é•¿æ±‚è€å¤´åŸºèµ„è¾¹æµè·¯çº§å°‘å›¾å±±ç»Ÿæ¥çŸ¥è¾ƒå°†ç»„è§è®¡åˆ«å¥¹æ‰‹è§’æœŸæ ¹è®ºè¿å†œæŒ‡å‡ ä¹åŒºå¼ºæ”¾å†³è¥¿è¢«å¹²åšå¿…æˆ˜å…ˆå›åˆ™ä»»å–æ®å¤„é˜Ÿå—ç»™è‰²å…‰é—¨å³ä¿æ²»åŒ—é€ ç™¾è§„çƒ­é¢†ä¸ƒæµ·å£ä¸œå¯¼å™¨å‹å¿—ä¸–é‡‘å¢äº‰æµé˜¶æ²¹æ€æœ¯æäº¤å—è”ä»€è®¤å…­å…±æƒæ”¶è¯æ”¹æ¸…å·±ç¾å†é‡‡è½¬æ›´å•é£åˆ‡æ‰“ç™½æ•™é€ŸèŠ±å¸¦å®‰åœºèº«è½¦ä¾‹çœŸåŠ¡å…·ä¸‡æ¯ç›®è‡³è¾¾èµ°ç§¯ç¤ºè®®å£°æŠ¥æ–—å®Œç±»å…«ç¦»ååç¡®æ‰ç§‘å¼ ä¿¡é©¬èŠ‚è¯ç±³æ•´ç©ºå…ƒå†µä»Šé›†æ¸©ä¼ åœŸè®¸æ­¥ç¾¤å¹¿çŸ³è®°éœ€æ®µç ”ç•Œæ‹‰æ—å¾‹å«ä¸”ç©¶è§‚è¶Šç»‡è£…å½±ç®—ä½æŒéŸ³ä¼—ä¹¦å¸ƒå¤å®¹å„¿é¡»é™…å•†ééªŒè¿æ–­æ·±éš¾è¿‘çŸ¿åƒå‘¨å§”ç´ æŠ€å¤‡åŠåŠé’çœåˆ—ä¹ å“çº¦æ”¯èˆ¬å²æ„ŸåŠ³ä¾¿å›¢å¾€é…¸å†å¸‚å…‹ä½•é™¤æ¶ˆæ„åºœç§°å¤ªå‡†ç²¾å€¼å·ç‡æ—ç»´åˆ’é€‰æ ‡å†™å­˜å€™æ¯›äº²å¿«æ•ˆæ–¯é™¢æŸ¥æ±Ÿå‹çœ¼ç‹æŒ‰æ ¼å…»æ˜“ç½®æ´¾å±‚ç‰‡å§‹å´ä¸“çŠ¶è‚²å‚äº¬è¯†é€‚å±åœ†åŒ…ç«ä½è°ƒæ»¡å¿å±€ç…§å‚çº¢ç»†å¼•å¬è¯¥é“ä»·ä¸¥ğŸ˜€ğŸ˜ƒğŸ˜„ğŸ˜ğŸ˜†ğŸ˜…ğŸ˜‚ğŸ¤£ğŸ˜ŠğŸ˜‡ğŸ™‚ğŸ™ƒğŸ˜‰ğŸ˜ŒğŸ˜ğŸ¥°ğŸ˜˜ğŸ˜—ğŸ˜™ğŸ˜šğŸ˜‹ğŸ˜›ğŸ˜ğŸ˜œğŸ¤ªğŸ¤¨ğŸ§ğŸ¤“ğŸ˜ğŸ¤©ğŸ¥³ğŸ˜ğŸ˜’ğŸ˜ğŸ˜”ğŸ˜ŸğŸ˜•ğŸ™â˜¹ï¸ğŸ˜£ğŸ˜–ğŸ˜«ğŸ˜©ğŸ¥ºğŸ˜¢ğŸ˜­ğŸ˜¤ğŸ˜ ğŸ˜¡ğŸ¤¬ğŸ¤¯ğŸ˜³ğŸ¥µğŸ¥¶ğŸ˜±ğŸ˜¨ğŸ˜°ğŸ˜¥ğŸ˜“ğŸ¤—ğŸ¤”ğŸ¤­ğŸ¤«ğŸ¤¥ğŸ˜¶ğŸ˜ğŸ˜‘ğŸ˜¬ğŸ™„ğŸ˜¯ğŸ˜¦ğŸ˜§ğŸ˜®ğŸ˜²ğŸ¥±ğŸ˜´ğŸ¤¤ğŸ˜ªğŸ˜µğŸ¤ğŸ¥´ğŸ¤¢ğŸ¤®ğŸ¤§ğŸ˜·ğŸ¤’ğŸ¤•ğŸ¤‘ğŸ¤ ğŸ˜ˆğŸ‘¿ğŸ‘¹ğŸ‘ºğŸ¤¡ğŸ’©ğŸ‘»ğŸ’€â˜ ï¸ğŸ‘½ğŸ‘¾ğŸ¤–ğŸƒğŸ˜ºğŸ˜¸ğŸ˜¹ğŸ˜»ğŸ˜¼ğŸ˜½ğŸ™€ğŸ˜¿ğŸ˜¾";
            
            // ç¡®ä¿åªæœ‰256ä¸ªå­—ç¬¦
            const trimmedCharset = defaultCharset.slice(0, 256);
            
            document.getElementById('charset').value = trimmedCharset;
            validateCharset();
            generateIndexCode();
        }
        
        // ç´¢å¼•ç åŠŸèƒ½
        function generateIndexCode() {
            const charset = document.getElementById('charset').value;
            // å°†å­—ç¬¦é›†è½¬æ¢ä¸ºBase64ç¼–ç 
            const base64Charset = btoa(unescape(encodeURIComponent(charset)));
            // ç”Ÿæˆç®€çŸ­çš„æ ‡è¯†ç¬¦
            const identifier = base64Charset.substring(0, 16);
            document.getElementById('indexCode').value = identifier;
            showMessage('å·²ç”Ÿæˆå­—ç¬¦é›†ç´¢å¼•ç ', 'success');
        }
        
        function copyIndexCode() {
            const indexCode = document.getElementById('indexCode');
            if (!indexCode.value) {
                showMessage('æ²¡æœ‰ç´¢å¼•ç å¯å¤åˆ¶', 'warning');
                return;
            }
            
            indexCode.select();
            document.execCommand('copy');
            showMessage('å·²å¤åˆ¶ç´¢å¼•ç åˆ°å‰ªè´´æ¿', 'success');
        }
        
        function applyIndexCode() {
            const indexCode = document.getElementById('indexCode').value;
            if (!indexCode) {
                showMessage('è¯·è¾“å…¥ç´¢å¼•ç ', 'warning');
                return;
            }
            
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥ä»æœåŠ¡å™¨æˆ–æœ¬åœ°å­˜å‚¨ä¸­æ ¹æ®ç´¢å¼•ç è·å–å­—ç¬¦é›†
            // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œç›´æ¥ä»æœ¬åœ°å­˜å‚¨ä¸­æŸ¥æ‰¾
            const savedCharsets = JSON.parse(localStorage.getItem('savedCharsets') || '{}');
            if (savedCharsets[indexCode]) {
                document.getElementById('charset').value = savedCharsets[indexCode];
                validateCharset();
                showMessage('å·²åº”ç”¨å­—ç¬¦é›†', 'success');
            } else {
                showMessage('æœªæ‰¾åˆ°åŒ¹é…çš„å­—ç¬¦é›†', 'error');
            }
        }
        
        function saveIndexCodeToStorage() {
            const charset = document.getElementById('charset').value;
            const indexCode = document.getElementById('indexCode').value;
            
            if (!indexCode) {
                showMessage('è¯·å…ˆç”Ÿæˆç´¢å¼•ç ', 'warning');
                return;
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            const savedCharsets = JSON.parse(localStorage.getItem('savedCharsets') || '{}');
            savedCharsets[indexCode] = charset;
            localStorage.setItem('savedCharsets', JSON.stringify(savedCharsets));
            
            showMessage('å­—ç¬¦é›†å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨', 'success');
        }
        
        function loadIndexCodeFromStorage() {
            const savedCharsets = JSON.parse(localStorage.getItem('savedCharsets') || '{}');
            const indexCodes = Object.keys(savedCharsets);
            
            if (indexCodes.length === 0) {
                showMessage('æœ¬åœ°å­˜å‚¨ä¸­æ²¡æœ‰ä¿å­˜çš„å­—ç¬¦é›†', 'warning');
                return;
            }
            
            // æ˜¾ç¤ºä¿å­˜çš„ç´¢å¼•ç åˆ—è¡¨ä¾›ç”¨æˆ·é€‰æ‹©
            const indexCodeList = indexCodes.map(code => `${code} (${savedCharsets[code].substring(0, 20)}...)`).join('\n');
            const selectedCode = prompt(`è¯·é€‰æ‹©è¦åŠ è½½çš„ç´¢å¼•ç :\n\n${indexCodeList}`, indexCodes[0]);
            
            if (selectedCode && savedCharsets[selectedCode]) {
                document.getElementById('charset').value = savedCharsets[selectedCode];
                document.getElementById('indexCode').value = selectedCode;
                validateCharset();
                showMessage('å·²åŠ è½½å­—ç¬¦é›†', 'success');
            }
        }
        
        function loadCharsetFromStorage() {
            // å°è¯•ä»æœ¬åœ°å­˜å‚¨åŠ è½½é»˜è®¤å­—ç¬¦é›†
            const savedCharsets = JSON.parse(localStorage.getItem('savedCharsets') || '{}');
            const defaultCharsetKey = Object.keys(savedCharsets).find(key => key.startsWith('default'));
            
            if (defaultCharsetKey) {
                document.getElementById('charset').value = savedCharsets[defaultCharsetKey];
                document.getElementById('indexCode').value = defaultCharsetKey;
                validateCharset();
            } else {
                resetDefaultCharset();
            }
        }
        
        // å…¨å­—ç¬¦ç¼–ç å‡½æ•°
        function encodeAllChars(text) {
            // ç¡®ä¿è¾“å…¥æ˜¯å­—ç¬¦ä¸²
            if (typeof text !== 'string') {
                if (text instanceof Uint8Array) {
                    text = decodeAllChars(text);
                } else {
                    throw new Error('encodeAllChars: è¾“å…¥å¿…é¡»æ˜¯å­—ç¬¦ä¸²æˆ–Uint8Array');
                }
            }
            
            // å°†æ–‡æœ¬è½¬æ¢ä¸ºUTF-16ä»£ç ç‚¹æ•°ç»„
            const codePoints = [];
            for (let i = 0; i < text.length; i++) {
                codePoints.push(text.charCodeAt(i));
            }
            
            // å°†ä»£ç ç‚¹æ•°ç»„è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„
            const bytes = new Uint8Array(codePoints.length * 2);
            for (let i = 0; i < codePoints.length; i++) {
                bytes[i * 2] = codePoints[i] & 0xFF;
                bytes[i * 2 + 1] = (codePoints[i] >> 8) & 0xFF;
            }
            
            return bytes;
        }
        
        // å…¨å­—ç¬¦è§£ç å‡½æ•°
        function decodeAllChars(bytes) {
            // å°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºä»£ç ç‚¹æ•°ç»„
            const codePoints = [];
            for (let i = 0; i < bytes.length; i += 2) {
                const codePoint = bytes[i] | (bytes[i + 1] << 8);
                codePoints.push(codePoint);
            }
            
            // å°†ä»£ç ç‚¹æ•°ç»„è½¬æ¢ä¸ºæ–‡æœ¬
            return String.fromCharCode(...codePoints);
        }
        
        // ä½¿ç”¨å­—ç¬¦é›†ç¼–ç 
        function bytesToCharset(bytes) {
            const charset = document.getElementById('charset').value;
            let result = '';
            
            for (let i = 0; i < bytes.length; i++) {
                result += charset[bytes[i]];
            }
            
            return result;
        }
        
        // ä½¿ç”¨å­—ç¬¦é›†è§£ç 
        function charsetToBytes(text) {
            const charset = document.getElementById('charset').value;
            const bytes = new Uint8Array(text.length);
            
            for (let i = 0; i < text.length; i++) {
                const index = charset.indexOf(text[i]);
                if (index === -1) {
                    throw new Error(`æ— æ•ˆçš„å­—ç¬¦: ${text[i]}`);
                }
                bytes[i] = index;
            }
            
            return bytes;
        }
        
        // å¢å¼ºçš„å¼‚æˆ–åŠ å¯†
        function enhancedXorEncrypt(text, key, round) {
            // ç¡®ä¿è¾“å…¥æ˜¯å­—ç¬¦ä¸²
            if (typeof text !== 'string') {
                if (text instanceof Uint8Array) {
                    text = decodeAllChars(text);
                } else {
                    throw new Error('enhancedXorEncrypt: è¾“å…¥å¿…é¡»æ˜¯å­—ç¬¦ä¸²æˆ–Uint8Array');
                }
            }
            
            const bytes = encodeAllChars(text);
            const keyBytes = new TextEncoder().encode(key);
            const encryptedBytes = new Uint8Array(bytes.length);
            
            for (let i = 0; i < bytes.length; i++) {
                const roundFactor = (round * 17 + i * 13) % 256;
                const keyByte = keyBytes[i % keyBytes.length];
                const mixedKey = (keyByte + roundFactor) % 256;
                encryptedBytes[i] = bytes[i] ^ mixedKey;
            }
            
            return encryptedBytes;
        }
        
        // å¢å¼ºçš„å¼‚æˆ–è§£å¯†
        function enhancedXorDecrypt(encryptedBytes, key, round) {
            // ç¡®ä¿è¾“å…¥æ˜¯å­—èŠ‚æ•°ç»„
            if (!(encryptedBytes instanceof Uint8Array)) {
                if (typeof encryptedBytes === 'string') {
                    encryptedBytes = encodeAllChars(encryptedBytes);
                } else {
                    throw new Error('enhancedXorDecrypt: è¾“å…¥å¿…é¡»æ˜¯Uint8Arrayæˆ–å­—ç¬¦ä¸²');
                }
            }
            
            const keyBytes = new TextEncoder().encode(key);
            const decryptedBytes = new Uint8Array(encryptedBytes.length);
            
            for (let i = 0; i < encryptedBytes.length; i++) {
                const roundFactor = (round * 17 + i * 13) % 256;
                const keyByte = keyBytes[i % keyBytes.length];
                const mixedKey = (keyByte + roundFactor) % 256;
                decryptedBytes[i] = encryptedBytes[i] ^ mixedKey;
            }
            
            return decodeAllChars(decryptedBytes);
        }
        
        // å¤šæ¬¡åŠ å¯†
        function multiEncrypt(text, key, rounds) {
            let currentData = text;
            
            for (let round = 0; round < rounds; round++) {
                // ç¡®ä¿è¾“å…¥æ˜¯å­—ç¬¦ä¸²
                if (currentData instanceof Uint8Array) {
                    currentData = decodeAllChars(currentData);
                }
                
                const encryptedBytes = enhancedXorEncrypt(currentData, key, round);
                
                if (round < rounds - 1) {
                    currentData = encryptedBytes;
                } else {
                    currentData = bytesToCharset(encryptedBytes);
                }
            }
            
            return currentData;
        }
        
        // å¤šæ¬¡è§£å¯†
        function multiDecrypt(encryptedData, key, rounds) {
            let currentData = encryptedData;
            
            for (let round = rounds - 1; round >= 0; round--) {
                if (round === rounds - 1) {
                    currentData = charsetToBytes(currentData);
                }
                
                currentData = enhancedXorDecrypt(currentData, key, round);
                
                if (round > 0 && !(currentData instanceof Uint8Array)) {
                    currentData = encodeAllChars(currentData);
                }
            }
            
            return currentData;
        }
        
        // æ™®é€šåŠ å¯†å‡½æ•°
        function encrypt() {
            const text = document.getElementById('inputText').value;
            const key = document.getElementById('key').value;
            const rounds = parseInt(document.getElementById('rounds').value);
            
            if (!text) {
                showMessage('è¯·è¾“å…¥è¦åŠ å¯†çš„æ–‡æœ¬', 'error');
                return;
            }
            
            if (!key) {
                showMessage('è¯·è¾“å…¥åŠ å¯†å¯†é’¥', 'warning');
                return;
            }
            
            // éªŒè¯å­—ç¬¦é›†
            if (!validateCharset()) {
                return;
            }
            
            try {
                const encryptedText = multiEncrypt(text, key, rounds);
                document.getElementById('outputText').value = encryptedText;
                updateStats();
                
                showMessage(`æ™®é€šåŠ å¯†æˆåŠŸï¼${rounds}è½®åŠ å¯†å®Œæˆ`, 'success');
            } catch (e) {
                showMessage('åŠ å¯†å¤±è´¥: ' + e.message, 'error');
                console.error(e);
            }
        }
        
        // æ™®é€šè§£å¯†å‡½æ•°
        function decrypt() {
            const encryptedText = document.getElementById('inputText').value;
            const key = document.getElementById('key').value;
            const rounds = parseInt(document.getElementById('rounds').value);
            
            if (!encryptedText) {
                showMessage('è¯·è¾“å…¥è¦è§£å¯†çš„æ–‡æœ¬', 'error');
                return;
            }
            
            if (!key) {
                showMessage('è¯·è¾“å…¥è§£å¯†å¯†é’¥', 'warning');
                return;
            }
            
            // éªŒè¯å­—ç¬¦é›†
            if (!validateCharset()) {
                return;
            }
            
            try {
                const decryptedText = multiDecrypt(encryptedText, key, rounds);
                document.getElementById('outputText').value = decryptedText;
                updateStats();
                
                showMessage(`æ™®é€šè§£å¯†æˆåŠŸï¼${rounds}è½®è§£å¯†å®Œæˆ`, 'success');
            } catch (e) {
                showMessage('è§£å¯†å¤±è´¥: ' + e.message, 'error');
                console.error(e);
            }
        }
        
        // è¶…çº§åŠ å¯†å‡½æ•°
        function superEncrypt() {
            const text = document.getElementById('inputText').value;
            const key = document.getElementById('key').value;
            const rounds = parseInt(document.getElementById('rounds').value);
            
            if (!text) {
                showMessage('è¯·è¾“å…¥è¦åŠ å¯†çš„æ–‡æœ¬', 'error');
                return;
            }
            
            if (!key) {
                showMessage('è¯·è¾“å…¥åŠ å¯†å¯†é’¥', 'warning');
                return;
            }
            
            // éªŒè¯å­—ç¬¦é›†
            if (!validateCharset()) {
                return;
            }
            
            try {
                // è¶…çº§åŠ å¯†ä½¿ç”¨æ›´å¤šè½®æ¬¡
                const superRounds = rounds + 3;
                let currentData = text;
                
                for (let round = 0; round < superRounds; round++) {
                    // å¦‚æœå½“å‰æ•°æ®æ˜¯å­—èŠ‚æ•°ç»„ï¼Œå…ˆè½¬æ¢ä¸ºå­—ç¬¦ä¸²
                    if (currentData instanceof Uint8Array) {
                        currentData = decodeAllChars(currentData);
                    }
                    
                    const encryptedBytes = enhancedXorEncrypt(currentData, key, round);
                    
                    // ç®€åŒ–ï¼šåªåœ¨æœ€åä¸€è½®ä½¿ç”¨å­—ç¬¦é›†ç¼–ç 
                    if (round === superRounds - 1) {
                        currentData = bytesToCharset(encryptedBytes);
                    } else {
                        // ä¸­é—´è½®æ¬¡ç›´æ¥ä½¿ç”¨å­—èŠ‚æ•°ç»„
                        currentData = encryptedBytes;
                    }
                }
                
                document.getElementById('outputText').value = currentData;
                updateStats();
                
                showMessage(`è¶…çº§åŠ å¯†æˆåŠŸï¼${superRounds}è½®åŠ å¯†å®Œæˆï¼Œç”Ÿæˆå¤–æ˜Ÿæ–‡ç»“æœ`, 'success');
            } catch (e) {
                showMessage('è¶…çº§åŠ å¯†å¤±è´¥: ' + e.message, 'error');
                console.error(e);
            }
        }
        
        // è¶…çº§è§£å¯†å‡½æ•°
        function superDecrypt() {
            const encryptedText = document.getElementById('inputText').value;
            const key = document.getElementById('key').value;
            const rounds = parseInt(document.getElementById('rounds').value);
            
            if (!encryptedText) {
                showMessage('è¯·è¾“å…¥è¦è§£å¯†çš„æ–‡æœ¬', 'error');
                return;
            }
            
            if (!key) {
                showMessage('è¯·è¾“å…¥è§£å¯†å¯†é’¥', 'warning');
                return;
            }
            
            // éªŒè¯å­—ç¬¦é›†
            if (!validateCharset()) {
                return;
            }
            
            try {
                // è¶…çº§è§£å¯†éœ€è¦åå‘å¤„ç†è¶…çº§åŠ å¯†çš„æ­¥éª¤
                const superRounds = rounds + 3;
                let currentData = encryptedText;
                
                for (let round = superRounds - 1; round >= 0; round--) {
                    if (round === superRounds - 1) {
                        // æœ€åä¸€è½®ä»å­—ç¬¦é›†è½¬æ¢
                        currentData = charsetToBytes(currentData);
                    }
                    
                    // è§£å¯†å½“å‰æ•°æ®
                    currentData = enhancedXorDecrypt(currentData, key, round);
                    
                    // ä¸­é—´è½®æ¬¡éœ€è¦è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„
                    if (round > 0 && !(currentData instanceof Uint8Array)) {
                        currentData = encodeAllChars(currentData);
                    }
                }
                
                document.getElementById('outputText').value = currentData;
                updateStats();
                
                showMessage(`è¶…çº§è§£å¯†æˆåŠŸï¼${superRounds}è½®è§£å¯†å®Œæˆ`, 'success');
            } catch (e) {
                showMessage('è¶…çº§è§£å¯†å¤±è´¥: ' + e.message, 'error');
                console.error(e);
            }
        }
        
        // å¼€å‘è€…åŠŸèƒ½ï¼šæ— å¯†é’¥è§£å¯†
        function decryptWithoutKey() {
            const encryptedText = document.getElementById('inputText').value;
            const rounds = parseInt(document.getElementById('rounds').value);
            
            if (!encryptedText) {
                showMessage('è¯·è¾“å…¥è¦è§£å¯†çš„æ–‡æœ¬', 'error');
                return;
            }
            
            try {
                // å°è¯•å¤šç§å¯èƒ½çš„å¯†é’¥
                const possibleKeys = [
                    "developer_backdoor_key_2024",
                    "admin",
                    "default",
                    "password", 
                    "key",
                    "secret",
                    "123456",
                    ""
                ];
                
                let decryptedText = null;
                let usedKey = "";
                
                // é¦–å…ˆå°è¯•æ™®é€šè§£å¯†
                for (let key of possibleKeys) {
                    try {
                        decryptedText = multiDecrypt(encryptedText, key, rounds);
                        // å¦‚æœè§£å¯†æˆåŠŸä¸”æœ‰å¯è¯»å†…å®¹ï¼Œå°±ä½¿ç”¨è¿™ä¸ªç»“æœ
                        if (decryptedText && decryptedText.length > 0) {
                            usedKey = key;
                            break;
                        }
                    } catch (e) {
                        // ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªå¯†é’¥
                        continue;
                    }
                }
                
                // å¦‚æœæ™®é€šè§£å¯†å¤±è´¥ï¼Œå°è¯•è¶…çº§è§£å¯†
                if (!decryptedText) {
                    const superRounds = rounds + 3;
                    for (let key of possibleKeys) {
                        try {
                            let currentData = encryptedText;
                            
                            for (let round = superRounds - 1; round >= 0; round--) {
                                if (round === superRounds - 1) {
                                    currentData = charsetToBytes(currentData);
                                }
                                
                                currentData = enhancedXorDecrypt(currentData, key, round);
                                
                                if (round > 0 && !(currentData instanceof Uint8Array)) {
                                    currentData = encodeAllChars(currentData);
                                }
                            }
                            
                            decryptedText = currentData;
                            if (decryptedText && decryptedText.length > 0) {
                                usedKey = key;
                                break;
                            }
                        } catch (e) {
                            continue;
                        }
                    }
                }
                
                if (decryptedText) {
                    document.getElementById('outputText').value = decryptedText;
                    updateStats();
                    showMessage(`å¼€å‘è€…æ¨¡å¼è§£å¯†æˆåŠŸï¼ä½¿ç”¨å¯†é’¥: "${usedKey || 'ç©ºå¯†é’¥'}"`, 'success');
                } else {
                    showMessage('æ— å¯†é’¥è§£å¯†å¤±è´¥ï¼Œæ— æ³•æ‰¾åˆ°æœ‰æ•ˆå¯†é’¥', 'error');
                }
                
            } catch (e) {
                showMessage('å¼€å‘è€…è§£å¯†å¤±è´¥: ' + e.message, 'error');
                console.error(e);
            }
        }
        
        // å¼€å‘è€…åŠŸèƒ½ï¼šå¯ç”¨åé—¨
        function enableBackdoor() {
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œå¯ä»¥å®ç°æ›´å¤æ‚çš„åé—¨æœºåˆ¶
            // ä¾‹å¦‚ï¼šä¿®æ”¹åŠ å¯†ç®—æ³•ã€æ·»åŠ éšè—çš„è§£å¯†è·¯å¾„ç­‰
            
            showMessage('å¼€å‘è€…åé—¨å·²å¯ç”¨ï¼ç³»ç»Ÿç°åœ¨åŒ…å«éšè—è§£å¯†è·¯å¾„', 'success');
            
            // è®°å½•åé—¨å¯ç”¨çŠ¶æ€ï¼ˆåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™å¯èƒ½ä¼šå­˜å‚¨åœ¨æ›´å®‰å…¨çš„åœ°æ–¹ï¼‰
            localStorage.setItem('dev_backdoor_enabled', 'true');
        }
        
        // å¼€å‘è€…åŠŸèƒ½ï¼šæ˜¾ç¤ºå¼€å‘è€…ä¿¡æ¯
        function showDevInfo() {
            const info = `
å¼€å‘è€…ç³»ç»Ÿä¿¡æ¯ï¼š
- ç‰ˆæœ¬: 3.1.0
- åŠ å¯†ç®—æ³•: å¢å¼ºå¼‚æˆ– + è‡ªå®šä¹‰å­—ç¬¦é›†ç¼–ç 
- æ”¯æŒå­—ç¬¦: å…¨Unicodeå­—ç¬¦é›†
- å­—ç¬¦é›†: å¯è‡ªå®šä¹‰256å­—ç¬¦
- åŠ å¯†æ¨¡å¼: æ™®é€šåŠ å¯† + è¶…çº§åŠ å¯†
- æ–°å¢åŠŸèƒ½: å­—ç¬¦é›†ç´¢å¼•ç 
- åé—¨çŠ¶æ€: ${localStorage.getItem('dev_backdoor_enabled') === 'true' ? 'å·²å¯ç”¨' : 'æœªå¯ç”¨'}
- æ—¶é—´æˆ³: ${new Date().toISOString()}
            `.trim();
            
            alert(info);
        }
        
        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard() {
            const outputText = document.getElementById('outputText');
            
            if (!outputText.value) {
                showMessage('æ²¡æœ‰å†…å®¹å¯å¤åˆ¶', 'warning');
                return;
            }
            
            outputText.select();
            document.execCommand('copy');
            
            showMessage('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
        }
        
        // æ¸…ç©º
        function clearAll() {
            document.getElementById('inputText').value = '';
            document.getElementById('outputText').value = '';
            document.getElementById('key').value = '';
            updateStats();
            showMessage('å·²æ¸…ç©ºæ‰€æœ‰å†…å®¹', 'info');
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message, type) {
            // ç§»é™¤ç°æœ‰æ¶ˆæ¯
            const existingMessage = document.querySelector('.message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            // åˆ›å»ºæ–°æ¶ˆæ¯
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;
            
            document.body.appendChild(messageDiv);
            
            // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                messageDiv.style.opacity = '0';
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.parentNode.removeChild(messageDiv);
                    }
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
